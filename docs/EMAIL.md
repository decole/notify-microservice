## Настройка очереди телеграм оповещений

1. Заиметь почтовый ящик в почтовом сервисе
2. Настроить в настройках безопасности почтового сервиса (в яндексе точно надо разрешать использование почтового программного обеспечения для отправки сообщений)
3. Вставить в `.env.local` параметры почтового сервиса. **MAILER_DSN**, **EMAIL_FROM**, **EMAIL_SUBJECT**
4. Запустить очерель email оповещений `php bin/console rabbitmq:consumer email -vv`
5. Запустить очередь сохранения исторический данных `php bin/console rabbitmq:consumer history -vv` **(на микросервис достаточно иметь один ээкземпляр слушателя исторических данных)**

### Рекомендации:

Сконфигурировать все параметры под себя (особено **MAILER_DSN** и **EMAIL_FROM**)

Яндекс почта требует, чтобы отправитель(from) был тем же, что и почтовый акаунт с которого отправляете сообщения.

Т.е. в **.env.local** EMAIL_FROM указать тот же имейл, например я сконфигурировал MAILER_DSN под почту **user@yandex.ru**, тогда
> у меня **EMAIL_FROM=user@yandex.ru**

Пример настроек для email в **.env.local**

```shell
MAILER_DSN=smtp://usser:password@smtp.yandex.ru:465
EMAIL_FROM=user@yandex.ru
EMAIL_SUBJECT="Notification service notify"
```

## Как отправить нотификацию

Далее отправить запрос на микросервис

`POST http://localhost:85/api/v1/send`

```json
{
    "type": "email",
    "email": "test@mail.ru",
    "message": "tester2"
}
```

где:
- **type** - обязательно указываем тип как **email**
- **email** - почта оповещаемого пользователя
- **message** - сообщение, которое нужно передать пользователю